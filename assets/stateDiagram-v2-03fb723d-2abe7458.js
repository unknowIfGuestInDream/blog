import{p as Q,d as B,s as X,D as H,a as Z,S as F,b as j,c as I}from"./styles-d9d0687b-94e1ca48.js";import{G as tt}from"./index-94331fab.js";import{l,g,s as x,d as G}from"./transform-1257b6b5.js";import{r as et}from"./index-64e46a5f-0e893fa6.js";import{c as ot}from"./setupGraphViewbox-e1099da8-31c6b74a.js";import{u as st}from"./utils-3cbdbddf-d2b91db7.js";import"./mermaidAPI-a1a81019-9e353ac0.js";import"./preload-helper-101896b7.js";import"./errorRenderer-11917bdc-8050bcb7.js";import"./commonDb-7528607a-6805f0a3.js";import"./isPlainObject-64357938.js";import"./array-9f3ba611.js";import"./path-53f90ab3.js";import"./framework-c2a9b692.js";import"./edges-02da71a2-4f64e592.js";import"./svgDraw-87c143cd-b2a94c83.js";const h="rect",C="rectWithTitle",nt="start",ct="end",it="divider",rt="roundedWithTitle",lt="note",at="noteGroup",T="statediagram",dt="state",Et=`${T}-${dt}`,m="transition",St="note",pt="note-edge",Tt=`${m} ${pt}`,_t=`${T}-${St}`,ut="cluster",ft=`${T}-${ut}`,Dt="cluster-alt",At=`${T}-${Dt}`,U="parent",V="note",bt="state",N="----",ht=`${N}${V}`,M=`${N}${U}`,Y="fill:none",W="fill: #333",z="c",q="text",K="normal";let y={},E=0;const yt=function(t){const n=Object.keys(t);for(const e of n)t[e]},gt=function(t,n){l.trace("Extracting classes"),n.db.clear();try{return n.parser.parse(t),n.db.extract(n.db.getRootDocV2()),n.db.getClasses()}catch(e){return e}};function $t(t){return t==null?"":t.classes?t.classes.join(" "):""}function R(t="",n=0,e="",c=N){const i=e!==null&&e.length>0?`${c}${e}`:"";return`${bt}-${t}${i}-${n}`}const b=(t,n,e,c,i,r)=>{const o=e.id,_=$t(c[o]);if(o!=="root"){let p=h;e.start===!0&&(p=nt),e.start===!1&&(p=ct),e.type!==H&&(p=e.type),y[o]||(y[o]={id:o,shape:p,description:G.sanitizeText(o,g()),classes:`${_} ${Et}`});const s=y[o];e.description&&(Array.isArray(s.description)?(s.shape=C,s.description.push(e.description)):s.description.length>0?(s.shape=C,s.description===o?s.description=[e.description]:s.description=[s.description,e.description]):(s.shape=h,s.description=e.description),s.description=G.sanitizeTextOrArray(s.description,g())),s.description.length===1&&s.shape===C&&(s.shape=h),!s.type&&e.doc&&(l.info("Setting cluster for ",o,w(e)),s.type="group",s.dir=w(e),s.shape=e.type===Z?it:rt,s.classes=s.classes+" "+ft+" "+(r?At:""));const u={labelStyle:"",shape:s.shape,labelText:s.description,classes:s.classes,style:"",id:o,dir:s.dir,domId:R(o,E),type:s.type,padding:15};if(e.note){const a={labelStyle:"",shape:lt,labelText:e.note.text,classes:_t,style:"",id:o+ht+"-"+E,domId:R(o,E,V),type:s.type,padding:15},d={labelStyle:"",shape:at,labelText:e.note.text,classes:s.classes,style:"",id:o+M,domId:R(o,E,U),type:"group",padding:0};E++;const f=o+M;t.setNode(f,d),t.setNode(a.id,a),t.setNode(o,u),t.setParent(o,f),t.setParent(a.id,f);let S=o,D=a.id;e.note.position==="left of"&&(S=a.id,D=o),t.setEdge(S,D,{arrowhead:"none",arrowType:"",style:Y,labelStyle:"",classes:Tt,arrowheadStyle:W,labelpos:z,labelType:q,thickness:K})}else t.setNode(o,u)}n&&n.id!=="root"&&(l.trace("Setting node ",o," to be child of its parent ",n.id),t.setParent(o,n.id)),e.doc&&(l.trace("Adding nodes children "),xt(t,e,e.doc,c,i,!r))},xt=(t,n,e,c,i,r)=>{l.trace("items",e),e.forEach(o=>{switch(o.stmt){case j:b(t,n,o,c,i,r);break;case H:b(t,n,o,c,i,r);break;case F:{b(t,n,o.state1,c,i,r),b(t,n,o.state2,c,i,r);const _={id:"edge"+E,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:Y,labelStyle:"",label:G.sanitizeText(o.description,g()),arrowheadStyle:W,labelpos:z,labelType:q,thickness:K,classes:m};t.setEdge(o.state1.id,o.state2.id,_,E),E++}break}})},w=(t,n=I)=>{let e=n;if(t.doc)for(let c=0;c<t.doc.length;c++){const i=t.doc[c];i.stmt==="dir"&&(e=i.value)}return e},Ct=function(t,n,e,c){l.info("Drawing state diagram (v2)",n),y={},c.db.getDirection();const{securityLevel:i,state:r}=g(),o=r.nodeSpacing||50,_=r.rankSpacing||50;l.info(c.db.getRootDocV2()),c.db.extract(c.db.getRootDocV2()),l.info(c.db.getRootDocV2());const p=c.db.getStates(),s=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:w(c.db.getRootDocV2()),nodesep:o,ranksep:_,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});b(s,void 0,c.db.getRootDocV2(),p,c.db,!0);let u;i==="sandbox"&&(u=x("#i"+n));const a=i==="sandbox"?x(u.nodes()[0].contentDocument.body):x("body"),d=a.select(`[id="${n}"]`),f=a.select("#"+n+" g");et(f,s,["barb"],T,n);const S=8;st.insertTitle(d,"statediagramTitleText",r.titleTopMargin,c.db.getDiagramTitle());const D=d.node().getBBox(),L=D.width+S*2,P=D.height+S*2;d.attr("class",T);const k=d.node().getBBox();ot(d,P,L,r.useMaxWidth);const v=`${k.x-S} ${k.y-S} ${L} ${P}`;l.debug(`viewBox ${v}`),d.attr("viewBox",v);const J=document.querySelectorAll('[id="'+n+'"] .edgeLabel .label');for(const $ of J){const O=$.getBBox(),A=document.createElementNS("http://www.w3.org/2000/svg",h);A.setAttribute("rx",0),A.setAttribute("ry",0),A.setAttribute("width",O.width),A.setAttribute("height",O.height),$.insertBefore(A,$.firstChild)}},Rt={setConf:yt,getClasses:gt,draw:Ct},zt={parser:Q,db:B,renderer:Rt,styles:X,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,B.clear()}};export{zt as diagram};
